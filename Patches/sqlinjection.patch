diff -Naur bookstore/BookDetail.jsp bookstore_secure/BookDetail.jsp
--- bookstore/BookDetail.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/BookDetail.jsp	2018-03-04 13:32:49.391455974 -0600
@@ -142,7 +142,8 @@
       if ( sDetailErr.length() > 0 ) return sDetailErr;
       try {
         // Execute SQL statement
-        stat.executeUpdate(sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL); 
+        pstmt.executeQuery();
       }
       catch(java.sql.SQLException e) {
         sDetailErr = e.toString(); return (sDetailErr);
@@ -210,7 +211,8 @@
       
       if ( isEmpty(pitem_id)) { bPK = false; }
       
-      sWhere += "item_id=" + toSQL(pitem_id, adNumber);
+      //pitem_id = toSQL(pitem_id, adNumber);
+      sWhere += "item_id = ?";
       primaryKeyParams += "<input type=\"hidden\" name=\"PK_item_id\" value=\""+pitem_id+"\"/>";
 
       sSQL = "select * from items where " + sWhere;
@@ -229,7 +231,9 @@
       if ( bPK &&  ! (sAction.equals("insert") && "Detail".equals(sForm))) {
 
         // Open recordset
-        rs = openrs( stat, sSQL);
+        PreparedStatement pstmt = conn.prepareStatement(sSQL); 
+        pstmt.setString(1, pitem_id); 
+        rs = pstmt.executeQuery();
         rs.next();
         String[] aFields = getFieldsName( rs );
         getRecordToHash( rs, rsHash, aFields );
@@ -388,19 +392,21 @@
       sSQL = "";
       // Create SQL statement
 
+      boolean insertValid = false;
       switch (iAction) {
   
         case iinsertAction :
           
+            //fldUserID = toSQL(fldUserID, adNumber);
+            //fldquantity = toSQL(fldquantity, adNumber);
+            flditem_id = toSQL(flditem_id, adNumber);
             sSQL = "insert into orders (" + 
                 "member_id," + 
                 "quantity," +
                 "item_id)" +
 
-                " values (" + 
-                toSQL(fldUserID, adNumber) + "," +
-                toSQL(fldquantity, adNumber) + "," +
-                toSQL(flditem_id, adNumber) + ")";
+                " values (?, ?, ?)";
+            insertValid = true;
           break;
   
       }
@@ -408,7 +414,13 @@
       if ( sOrderErr.length() > 0 ) return sOrderErr;
       try {
         // Execute SQL statement
-        stat.executeUpdate(sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL); 
+	if (insertValid) {
+            pstmt.setString(1, fldUserID); 
+            pstmt.setString(2, fldquantity);
+            pstmt.setString(3, flditem_id);
+	}
+	pstmt.executeUpdate();
       }
       catch(java.sql.SQLException e) {
         sOrderErr = e.toString(); return (sOrderErr);
@@ -469,7 +481,8 @@
       
       if ( isEmpty(porder_id)) { bPK = false; }
       
-      sWhere += "order_id=" + toSQL(porder_id, adNumber);
+      //porder_id = toSQL(porder_id, adNumber);
+      sWhere += "order_id = ?";
       primaryKeyParams += "<input type=\"hidden\" name=\"PK_order_id\" value=\""+porder_id+"\"/>";
 
       sSQL = "select * from orders where " + sWhere;
@@ -488,7 +501,9 @@
       if ( bPK &&  ! (sAction.equals("insert") && "Order".equals(sForm))) {
 
         // Open recordset
-        rs = openrs( stat, sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL); 
+        pstmt.setString(1, porder_id); 
+        rs = pstmt.executeQuery();
         rs.next();
         String[] aFields = getFieldsName( rs );
         getRecordToHash( rs, rsHash, aFields );
@@ -583,7 +598,8 @@
       if ( iAction == iupdateAction || iAction == ideleteAction ) { 
         pPKitem_id = getParam( request, "PK_item_id");
         if ( isEmpty(pPKitem_id)) return sRatingErr;
-        sWhere = "item_id=" + toSQL(pPKitem_id, adNumber);
+	//pPKitem_id = toSQL(pPKitem_id, adNumber);
+        sWhere = "item_id = ?"
       }
 
 
@@ -615,18 +631,22 @@
 
 
       sSQL = "";
+      boolean isChange = false;
       // Create SQL statement
 
       switch (iAction) {
   
       case iupdateAction:
         
-sSQL = "update items set rating=rating+" + getParam(request, "rating") + ", rating_count=rating_count+1 where item_id=" + getParam(request, "item_id");
+sSQL = "update items set rating = ?, rating_count = ? where item_id = ?";
         if ("".equals(sSQL)) {
+	  //fldrating = toSQL(fldrating, adNumber)
+	  //fldrating_count = toSQL(fldrating_count, adNumber);
           sSQL = "update items set " +
-                "rating=" + toSQL(fldrating, adNumber) +
-                ",rating_count=" + toSQL(fldrating_count, adNumber);
+                "rating = ?" +
+                ",rating_count = ?";
           sSQL = sSQL + " where " + sWhere;
+	  isChange = true;
         }
         break;
       
@@ -635,7 +655,17 @@
       if ( sRatingErr.length() > 0 ) return sRatingErr;
       try {
         // Execute SQL statement
-        stat.executeUpdate(sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL); 
+        if (isChange) {
+		pstmt.setString(1, fldrating); 
+		pstmt.setString(2, fldrating_count); 
+		pstmt.setString(3, pPKitem_id); 
+	} else {
+		pstmt.setString(1, rating + getParam(request, "rating")); 
+		pstmt.setString(2, rating_count + 1); 
+		pstmt.setString(3, getParam(request, "item_id")); 
+	}
+        pstmt.executeUpdate();
       }
       catch(java.sql.SQLException e) {
         sRatingErr = e.toString(); return (sRatingErr);
@@ -702,7 +732,8 @@
       
       if ( isEmpty(pitem_id)) { bPK = false; }
       
-      sWhere += "item_id=" + toSQL(pitem_id, adNumber);
+      //pitem_id = toSQL(pitem_id, adNumber);
+      sWhere += "item_id = ?";
       primaryKeyParams += "<input type=\"hidden\" name=\"PK_item_id\" value=\""+pitem_id+"\"/>";
 
       sSQL = "select * from items where " + sWhere;
@@ -721,7 +752,9 @@
       if ( bPK &&  ! (sAction.equals("insert") && "Rating".equals(sForm))) {
 
         // Open recordset
-        rs = openrs( stat, sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL); 
+        pstmt.setString(1, pitem_id); 
+        rs = pstmt.executeQuery();
         rs.next();
         String[] aFields = getFieldsName( rs );
         getRecordToHash( rs, rsHash, aFields );
@@ -804,4 +837,4 @@
 
     }
     catch (Exception e) { out.println(e.toString()); }
-  } %>
\ No newline at end of file
+  } %>
diff -Naur bookstore/Common.jsp bookstore_secure/Common.jsp
--- bookstore/Common.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/Common.jsp	2018-03-04 13:32:49.487456315 -0600
@@ -1,3 +1,4 @@
+<%@ page import="java.sql.PreparedStatement, java.sql.Statement" %>
 <%!
 //
 //   Filename: Common.jsp
@@ -207,7 +208,7 @@
     }
      switch (type) {
        case adText: {
-        param = replace(param, "' ", "''");
+         param = replace(param, "' ", "''");
          param = replace(param, "&amp;", "&");
          param = "'" + param + "'";
         break;
diff -Naur bookstore/Default.jsp bookstore_secure/Default.jsp
--- bookstore/Default.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/Default.jsp	2018-03-04 13:32:49.483456300 -0600
@@ -194,10 +194,10 @@
         sSortParams = "FormRecommended_Sorting=" + sSort + "&FormRecommended_Sorted=" + "&";
       }
     
-      if ( iSort == 1) { sOrder = " order by i.name" + sDirection; }
-      if ( iSort == 2) { sOrder = " order by i.author" + sDirection; }
-      if ( iSort == 3) { sOrder = " order by i.image_url" + sDirection; }
-      if ( iSort == 4) { sOrder = " order by i.price" + sDirection; }
+      if ( iSort == 1) { sOrder = " order by i.name ?"; }
+      if ( iSort == 2) { sOrder = " order by i.author ?"; }
+      if ( iSort == 3) { sOrder = " order by i.image_url ?"; }
+      if ( iSort == 4) { sOrder = " order by i.price ?"; }
     }
   
 
@@ -240,7 +240,11 @@
   try {
     java.sql.ResultSet rs = null;
     // Open recordset
-    rs = openrs( stat, sSQL);
+    PreparedStatement pstmt = conn.prepareStatement(sSQL);
+    if (!sDirection.equals("")) {
+    	pstmt.setString(1, sDirection);
+    }
+    rs = pstmt.executeQuery();
     iCounter = 0;
     absolute (rs, (iPage-1)*RecordsPerPage+1);
     java.util.Hashtable rsHash = new java.util.Hashtable();
@@ -371,7 +375,8 @@
   try {
     java.sql.ResultSet rs = null;
     // Open recordset
-    rs = openrs( stat, sSQL);
+    PreparedStatement pstmt = conn.prepareStatement(sSQL);
+    rs = pstmt.executeQuery();
     iCounter = 0;
     
     java.util.Hashtable rsHash = new java.util.Hashtable();
@@ -462,7 +467,8 @@
   try {
     java.sql.ResultSet rs = null;
     // Open recordset
-    rs = openrs( stat, sSQL);
+    PreparedStatement pstmt = conn.prepareStatement(sSQL);
+    rs = pstmt.executeQuery();
     iCounter = 0;
     
     java.util.Hashtable rsHash = new java.util.Hashtable();
@@ -552,7 +558,8 @@
   try {
     java.sql.ResultSet rs = null;
     // Open recordset
-    rs = openrs( stat, sSQL);
+    PreparedStatement pstmt = conn.prepareStatement(sSQL);
+    rs = pstmt.executeQuery();
     iCounter = 0;
     
     java.util.Hashtable rsHash = new java.util.Hashtable();
@@ -649,7 +656,8 @@
   try {
     java.sql.ResultSet rs = null;
     // Open recordset
-    rs = openrs( stat, sSQL);
+    PreparedStatement pstmt = conn.prepareStatement(sSQL);
+    rs = pstmt.executeQuery();
     iCounter = 0;
     
     java.util.Hashtable rsHash = new java.util.Hashtable();
@@ -740,7 +748,8 @@
   try {
     java.sql.ResultSet rs = null;
     // Open recordset
-    rs = openrs( stat, sSQL);
+    PreparedStatement pstmt = conn.prepareStatement(sSQL);
+    rs = pstmt.executeQuery();
     iCounter = 0;
     
     java.util.Hashtable rsHash = new java.util.Hashtable();
@@ -775,4 +784,4 @@
   }
   catch (Exception e) { out.println(e.toString()); }
 }
-%>
\ No newline at end of file
+%>
diff -Naur bookstore/.git/index bookstore_secure/.git/index
--- bookstore/.git/index	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/.git/index	2018-03-04 13:32:49.391455974 -0600
@@ -1,12 +1,12 @@
-DIRC      ?Z›a·0½­Z›a·0½­    ç_  í          ;I/3ûÓ€(p–`Bš¥m­ˆ5&u` AdminBooks.jsp    Z›a·0½­Z›a·0½­    ça  í          +p:ÀPlocbu§TYàqû AdminMenu.jsp     Z›a·0½­Z›a·0½­    ¹   í          `!'Èz¯†ˆÌƒEÑÌ í®ª® AdvSearch.jsp     ZœJ!:(×ZœJ!:(×    ¹!  í          xtGg
+DIRC      ?Z›a·0½­Z›a·0½­    ç_  í          ;I/3ûÓ€(p–`Bš¥m­ˆ5&u` AdminBooks.jsp    Z›a·0½­Z›a·0½­    ça  í          +p:ÀPlocbu§TYàqû AdminMenu.jsp     Z›a·0½­Z›a·0½­    ¹   í          `!'Èz¯†ˆÌƒEÑÌ í®ª® AdvSearch.jsp     Z›a·0½­Z›a·0½­    ¹!  í          xtGg
 Bç†^¬¥¯_à‡ŞÖB• BookDetail.jsp    Z›a·0½­Z›a·0½­    ¹"  í          CäS[ãJÄmòÎLÜFñ;ŸD-
-´2 BookMaint.jsp     ZœI¯8ñˆ8ZœI¯8ñˆ8    ¹+  í          Mé<FCÇAB×ö¨Ñ]¦Ö}Ã¾Ò? 	Books.jsp Z›a·0½­Z›a·0½­    ¹$  í          ‘šg¿ç6Dœ+’]“„| 9‰j CardTypesGrid.jsp Z›a·0½­Z›a·0½­    ¹%  í          ($t2kşPßÇ¤¾µôZàòı¹Ëè“ CardTypesRecord.jsp       Z›a·0½­Z›a·0½­    ¹&  í          "VÆw“°=«ƒ.q)¬ĞZ[ÈM CategoriesGrid.jsp        Z›a·0½­Z›a·0½­    ¹'  í          (0î®ÕJ2 ƒ$û¿!Z4fjí‹À: CategoriesRecord.jsp      ZœJ!:(×ZœJ!:(×    ¹9  í          +—K(4üüdŸ`7ªîÏÂªıv²ı¼ 
-Common.jsp        ZœJ!:(×ZœJ!:(×    ¹.  í          {Ñm WŸÚ&å·øë·	|÷‰}‚Q Default.jsp       Z›a·0½­Z›a·0½­    ¹;  í          #ä«<vAn¹4 nãqÕ¢I~( EditorialCatGrid.jsp      Z›a·0½­Z›a·0½­    ¹)  í          *ÂpmÒêMœÙ!µ2 AÂar¶d EditorialCatRecord.jsp    Z›a·0½­Z›a·0½­    ¹,  í          )CºÔó	OùZRÌÑÅ3”K3§v: EditorialsGrid.jsp        Z›a·0½­Z›a·0½­    ¹-  í          4Í>/E¨1‹5C,êFÕ|„^Ñ EditorialsRecord.jsp      ZŒ ÓjúZŒ Ójú    ¹0  í          	TÔÓn¥Œ>ÒÈá OÿÑşğkZ<Ê 
+´2 BookMaint.jsp     ZœI¯8ñˆ8ZœI¯8ñˆ8    ¹+  í          Mé<FCÇAB×ö¨Ñ]¦Ö}Ã¾Ò? 	Books.jsp Z›a·0½­Z›a·0½­    ¹$  í          ‘šg¿ç6Dœ+’]“„| 9‰j CardTypesGrid.jsp Z›a·0½­Z›a·0½­    ¹%  í          ($t2kşPßÇ¤¾µôZàòı¹Ëè“ CardTypesRecord.jsp       Z›a·0½­Z›a·0½­    ¹&  í          "VÆw“°=«ƒ.q)¬ĞZ[ÈM CategoriesGrid.jsp        Z›a·0½­Z›a·0½­    ¹'  í          (0î®ÕJ2 ƒ$û¿!Z4fjí‹À: CategoriesRecord.jsp      Z›a·0½­Z›a·0½­    ¹(  í          +—K(4üüdŸ`7ªîÏÂªıv²ı¼ 
+Common.jsp        ZŒ ÓjúZŒ Ójú    ¹+  í          {Ñm WŸÚ&å·øë·	|÷‰}‚Q Default.jsp       Z›a·0½­Z›a·0½­    ¹;  í          #ä«<vAn¹4 nãqÕ¢I~( EditorialCatGrid.jsp      Z›a·0½­Z›a·0½­    ¹)  í          *ÂpmÒêMœÙ!µ2 AÂar¶d EditorialCatRecord.jsp    Z›a·0½­Z›a·0½­    ¹,  í          )CºÔó	OùZRÌÑÅ3”K3§v: EditorialsGrid.jsp        Z›a·0½­Z›a·0½­    ¹-  í          4Í>/E¨1‹5C,êFÕ|„^Ñ EditorialsRecord.jsp      ZŒ ÓjúZŒ Ójú    ¹0  í          	TÔÓn¥Œ>ÒÈá OÿÑşğkZ<Ê 
 Footer.jsp        ZŒ ÓjúZŒ Ójú    ¹1  í          
 õr˜O+ù÷Sÿ¹‡|BE´  
-Header.jsp        ZœJ!:(×ZœJ!:(×    ¹*  í          ¢òl^Ğ<O`Œš6ÇÒ}fòW¸y 	Login.jsp ZŒ ÓjúZŒ Ójú    ¹3  í           j°—^yœœÍnvz¼øÊ,º†=à META-INF/MANIFEST.MF      Z›a·0½­Z›a·0½­    èÖ  í          3j3¸%Ã}‘¯»×Æy7ûZ;Ô MembersGrid.jsp   Z›a·0½­Z›a·0½­    ¹/  í          FDïehÖ;cØÆ@s:>J¤V›  MembersInfo.jsp   Z›a·0ú¶Z›a·0ú¶    ¹4  í          R†ğÂ†¿Œ 5h\İdÚÑvwÒ­¢| MembersRecord.jsp ZœJ!:(×ZœJ!:(×    ¹8  í          @œV­ùU^ë]Ô
+Header.jsp        Zšä%–Ù]Zšä%–Ù]    ¹±  í          ¢òl^Ğ<O`Œš6ÇÒ}fòW¸y 	Login.jsp ZŒ ÓjúZŒ Ójú    ¹3  í           j°—^yœœÍnvz¼øÊ,º†=à META-INF/MANIFEST.MF      Z›a·0½­Z›a·0½­    èÖ  í          3j3¸%Ã}‘¯»×Æy7ûZ;Ô MembersGrid.jsp   Z›a·0½­Z›a·0½­    ¹/  í          FDïehÖ;cØÆ@s:>J¤V›  MembersInfo.jsp   Z›a·0ú¶Z›a·0ú¶    ¹4  í          R†ğÂ†¿Œ 5h\İdÚÑvwÒ­¢| MembersRecord.jsp Z›a·0ú¶Z›a·0ú¶    ¹5  í          @œV­ùU^ë]Ô
 å!Âõ°å# 
-MyInfo.jsp        Z›a·0ú¶Z›a·0ú¶    ¹6  í          6Š’ú«!½ÏæÏ?Öv·uµ€b> OrdersGrid.jsp    Z›a·0ú¶Z›a·0ú¶    ßê  í          6ı?ó"S^"‰Lìmé{ú0ëFæú OrdersRecord.jsp  ZœJ!:(×ZœJ!:(×    ¹(  í          Cş)É‰YŞ;q W{ÀcÖ” Registration.jsp  Z›a·0ú¶Z›a·0ú¶    ¹<  í          MÏ–p`câsÈ*Wæä×ù¸é“ ShoppingCart.jsp  ZœJ!:(×ZœJ!:(×    ¹#  í          /|43…ì—Ø5Ì&H®)	* ShoppingCartRecord.jsp    ZŒ M|ùZŒ M|ù    ¹=  í          yª†j¨Ü`šĞ(oáÒĞ¿5[mv  database/SQL/BookStore_MySQL.sql  ZŒ M|ùZŒ M|ù    ¹>  í           æI ²B¤z¿_ÏÚîş
+MyInfo.jsp        Z›a·0ú¶Z›a·0ú¶    ¹6  í          6Š’ú«!½ÏæÏ?Öv·uµ€b> OrdersGrid.jsp    Z›a·0ú¶Z›a·0ú¶    ßê  í          6ı?ó"S^"‰Lìmé{ú0ëFæú OrdersRecord.jsp  Z›a·0ú¶Z›a·0ú¶    ¹8  í          Cş)É‰YŞ;q W{ÀcÖ” Registration.jsp  Z›a·0ú¶Z›a·0ú¶    ¹<  í          MÏ–p`câsÈ*Wæä×ù¸é“ ShoppingCart.jsp  Z›a·0ú¶Z›a·0ú¶    ¹*  í          /|43…ì—Ø5Ì&H®)	* ShoppingCartRecord.jsp    ZŒ M|ùZŒ M|ù    ¹=  í          yª†j¨Ü`šĞ(oáÒĞ¿5[mv  database/SQL/BookStore_MySQL.sql  ZŒ M|ùZŒ M|ù    ¹>  í           æI ²B¤z¿_ÏÚîş
 ãt²û  images/1stars.gif ZŒ M|ùZŒ M|ù    ¹?  í           îøTÇ#Êg#æ<¤iËi|1ñt images/2stars.gif ZŒ M|ùZŒ M|ù    ¹@  í           ôÑšÑauÿhÒ±¡’•—0Öf‰b images/3stars.gif ZŒ M|ùZŒ M|ù    ¹A  í           ğƒ6ÃN4ºR‰Ì)J2*A4è images/4stars.gif ZŒ M|ùZŒ M|ù    ¹B  í           èƒŸR8×ïÇ€¢¥7:^¢¸s•ö> images/5stars.gif ZŒ M|ùZŒ M|ù    ¹C  í          Õ<Ø	nŠ|^êïQù#ûwD ³ images/Logo_bookstore.gif ZŒ M|ùZŒ M|ù    ¹D  í          İ9}¹ŠÁC³ì4¿Tw!Âfª’&Ò images/books/0072122420.jpg       ZŒ M|ùZŒ M|ù    ¹E  í          À¦E*£rØÁŒZ6U‰š¨õJ)8è images/books/020135358X.gif       ZŒ M|ùZŒ M|ù    ¹F  í          ‘#.Ü¬/ïøÍW[^‘ª€bæL images/books/0201354934.jpg       ZŒ M|ùZŒ M|ù    ¹G  í          ­;1©Ü9	îè£Ñ¾ ¥Aª= images/books/0596000278.jpg       ZŒ M|ùZŒ M|ù    ¹H  í          #Ø‚1İ\öâwL»¿b6¶wl3 images/books/0672317842.jpg       ZŒ M|ùZŒ M|ù    ¹I  í          ×k·¾	s¿F*Ë´I%)YûÊP images/books/0672317966.jpg       ZŒ M|ùZŒ M|ù    ¹J  í          \~âóº}•áè„#N­`Câvº‰ images/books/0735609667.jpg       ZŒ M|ùZŒ M|ù    ¹K  í          Ø7êCÈàtJEä¨÷óíÊÔ images/books/0735709211.jpg       ZŒ M|ùZŒ M|ù    ¹L  í          rš;æÇLkŠxd/k_?à”ÀÑ images/books/0735709491.jpg       ZŒ M|ùZŒ M|ù    ¹M  í          ¥ÆóñCr´*SŠÚ¥†°jĞ‘ images/books/0735709971.jpg       ZŒ M|ùZŒ M|ù    ¹N  í          ß´úªás5.iV†ØO”V!Ñ images/books/0761530169.jpg       ZŒ M|ùZŒ M|ù    ¹O  í          aY|¤¨º2˜Bãn‹1İE+p images/books/0782127738.jpg       ZŒ M|ùZŒ M|ù    ¹P  í          Ué¢ÆxÚ²Ÿp$¢İ?\ıb images/books/0789724405.jpg       ZŒ M|ùZŒ M|ù    ¹Q  í          07")ilJ¿´™Å—×/¯ííhºh images/books/0879304979.gif       ZŒ M|ùZŒ M|ù    ¹R  í          ‹Ÿè=Bğ>RmMdÂŸY·ı£9 images/books/1565924347.jpg       ZŒ M|ùZŒ M|ù    ¹S  í          Z2Øÿ†5ÔwÉceK­DU9´Gç{ images/books/1565925157.jpg       ZŒ M|ùZŒ M|ù    ¹T  í          ßÛüîÃyƒ£MY æpk± images/books/1861002726.jpg       ZŒ M|ùZŒ M|ù    ¹U  í           ^‹œ?øO…2¬‘
 MYG images/books/1861003382.jpg       ZŒ M|ùZŒ M|ù    ¹V  í           »q#Fs8³FcÒNB· images/books/1861004656.jpg       ZŒ M|ùZŒ M|ù    ¹W  í          <-Ùƒ[İ€R½k&Ìâ*H images/books/1861004877.jpg       ZŒ M|ùZŒ M|ù    ¹X  í          …jP•ş"]B*ÕäT¸ images/books/1884133193.gif       ZŒ M|ùZŒ M|ù    ¹Y  í          ôğ™È]µº`d=Có_øŒğòr/ images/books/1884777996.jpg       ZŒ M|ùZŒ M|ù    ¹Z  í          	›†p&±v%tåÂ+Q”p­q¾ images/icon_admin.gif     ZŒ M|ùZŒ M|ù    ¹[  í          Ã7P×Â*Õ€áwoá@ØÔckQšƒ images/icon_home.gif      ZŒ M|ùZŒ M|ù    ¹\  í          	…Ãû»³ÍÕ8¯ãßësOiF0btß images/icon_reg.gif       ZŒ M|ùZŒ M|ù    ¹]  í          	{`“é˜½Mµ%V>àŸÚ¨úJ] images/icon_shop.gif      ZŒ M|ùZŒ M|ù    ¹^  í          „ÕhTÅà1‘ Ëó¼Pöx¼
-fx images/icon_sign.gif      İB¶ VwØn£;é¾{ı®ÈŸß{
\ No newline at end of file
+fx images/icon_sign.gif      „U}öÛúı3JÊÔµ¹(#q
diff -Naur bookstore/Login.jsp bookstore_secure/Login.jsp
--- bookstore/Login.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/Login.jsp	2018-03-04 13:32:49.391455974 -0600
@@ -84,8 +84,14 @@
          
           String sLogin = getParam( request, "Login");
           String sPassword = getParam( request, "Password");
+	  //sLogin = toSQL(sLogin, adText);
+	  //sPassword = toSQL(sPassword, adText);
           java.sql.ResultSet rs = null;
-          rs = openrs( stat, "select member_id, member_level from members where member_login =" + toSQL(sLogin, adText) + " and member_password=" + toSQL(sPassword, adText));
+	  String query = "select member_id, member_level from members where member_login = ? and member_password = ?";
+	  PreparedStatement pstmt = conn.prepareStatement(query);
+	  pstmt.setString(1, sLogin);
+	  pstmt.setString(2, sPassword);
+	  rs = pstmt.executeQuery();
           
           if ( rs.next() ) {
             // Login and password passed
@@ -171,4 +177,4 @@
     }
     catch (Exception e) { out.println(e.toString()); }
   }
-%>
\ No newline at end of file
+%>
diff -Naur bookstore/MyInfo.jsp bookstore_secure/MyInfo.jsp
--- bookstore/MyInfo.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/MyInfo.jsp	2018-03-04 13:32:49.391455974 -0600
@@ -112,7 +112,8 @@
       if ( iAction == iupdateAction || iAction == ideleteAction ) {
         pPKmember_id = getParam( request, "PK_member_id");
         if ( isEmpty(pPKmember_id)) return sFormErr;
-        sWhere = "member_id=" + toSQL(pPKmember_id, adNumber);
+	pPKmember_id = toSQL(pPKmember_id, adNumber);
+        sWhere = "member_id = ?";
       }
 
 
@@ -164,23 +165,34 @@
 
 
       sSQL = "";
+      boolean updateValid = false;
       // Create SQL statement
 
       switch (iAction) {
 
       case iupdateAction:
 
+	  /*fldmember_password = toSQL(fldmember_password, adText);
+	  fldname = toSQL(fldname, adText);
+	  fldlast_name = toSQL(fldlast_name, adText);
+	  fldemail = toSQL(fldemail, adText);
+	  fldaddress = toSQL(fldaddress, adText);
+	  fldphone = toSQL(fldphone, adText);
+	  fldnotes = toSQL(fldnotes, adText);
+	  fldcard_type_id = toSQL(fldcard_type_id, adNumber);
+	  fldcard_number = toSQL(fldcard_number, adText);*/
           sSQL = "update members set " +
-                "member_password=" + toSQL(fldmember_password, adText) +
-                ",first_name=" + toSQL(fldname, adText) +
-                ",last_name=" + toSQL(fldlast_name, adText) +
-                ",email=" + toSQL(fldemail, adText) +
-                ",address=" + toSQL(fldaddress, adText) +
-                ",phone=" + toSQL(fldphone, adText) +
-                ",notes=" + toSQL(fldnotes, adText) +
-                ",card_type_id=" + toSQL(fldcard_type_id, adNumber) +
-                ",card_number=" + toSQL(fldcard_number, adText);
+                "member_password = ?" +
+                ",first_name = ?" +
+                ",last_name = ?" +
+                ",email = ?" + 
+                ",address = ?" +
+                ",phone = ?" +
+                ",notes = ?" +
+                ",card_type_id = ?" +
+                ",card_number = ?";
           sSQL = sSQL + " where " + sWhere;
+	  updateValid = true;
         break;
 
       }
@@ -188,7 +200,20 @@
       if ( sFormErr.length() > 0 ) return sFormErr;
       try {
         // Execute SQL statement
-        stat.executeUpdate(sSQL);
+	      PreparedStatement pstmt = conn.prepareStatement(sSQL);
+	      if (updateValid) {
+		  pstmt.setString(1, fldmember_password);
+		  pstmt.setString(2, fldname);
+		  pstmt.setString(3, fldlast_name);
+		  pstmt.setString(4, fldemail);
+		  pstmt.setString(5, fldaddress);
+		  pstmt.setString(6, fldphone);
+		  pstmt.setString(7, fldnotes);
+		  pstmt.setString(8, fldcard_type_id);
+		  pstmt.setString(9, fldcard_number);
+		  pstmt.setString(10, pPKmember_id);
+	      }
+	      pstmt.executeUpdate();
       }
       catch(java.sql.SQLException e) {
         sFormErr = e.toString(); return (sFormErr);
@@ -261,7 +286,7 @@
       String pmember_id = (String) session.getAttribute("UserID");
       if ( isEmpty(pmember_id)) { bPK = false; }
 
-      sWhere += "member_id=" + toSQL(pmember_id, adNumber);
+      sWhere += "member_id = ?";
       primaryKeyParams += "<input type=\"hidden\" name=\"PK_member_id\" value=\""+pmember_id+"\"/>";
 
       sSQL = "select * from members where " + sWhere;
@@ -280,7 +305,9 @@
       if ( bPK &&  ! (sAction.equals("insert") && "Form".equals(sForm))) {
 
         // Open recordset
-        rs = openrs( stat, sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL);
+        pstmt.setString(1, pmember_id);
+        rs = pstmt.executeQuery();
         rs.next();
         String[] aFields = getFieldsName( rs );
         getRecordToHash( rs, rsHash, aFields );
diff -Naur bookstore/Registration.jsp bookstore_secure/Registration.jsp
--- bookstore/Registration.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/Registration.jsp	2018-03-04 13:32:49.391455974 -0600
@@ -178,6 +178,7 @@
 
 
       sSQL = "";
+      boolean insertValid = false;
       // Create SQL statement
 
       switch (iAction) {
@@ -194,17 +195,8 @@
                 "phone," +
                 "card_type_id," +
                 "card_number)" +
-
-                " values (" + 
-                (fldmember_login) + "," +
-                (fldmember_password) + "," +
-                (fldfirst_name) + "," +
-                (fldlast_name) + "," +
-                (fldemail) + "," +
-                (fldaddress) + "," +
-                (fldphone) + "," +
-                (fldcard_type_id) + "," +
-                (fldcard_number) + ")";
+                " values ( ?, ?, ?, ?, ?, ?, ?, ?, ?)"; 
+		insertValid = true;
           break;
   
       }
@@ -212,7 +204,19 @@
       if ( sRegErr.length() > 0 ) return sRegErr;
       try {
         // Execute SQL statement
-        stat.executeUpdate(sSQL);
+        PreparedStatement pstmt = conn.prepareStatement(sSQL);
+	if (insertValid) {
+	    	pstmt.setString(1, fldmember_login);
+		pstmt.setString(2, fldmember_password);
+		pstmt.setString(3, fldfirst_name);
+		pstmt.setString(4, fldlast_name);
+		pstmt.setString(5, fldemail);
+		pstmt.setString(6, fldaddress);
+		pstmt.setString(7, fldphone);
+		pstmt.setString(8, fldcard_type_id);
+		pstmt.setString(9, fldcard_number);
+	}
+        pstmt.executeUpdate();
       }
       catch(java.sql.SQLException e) {
         sRegErr = e.toString(); return (sRegErr);
@@ -283,11 +287,11 @@
         pmember_id = getParam( request, "PK_member_id");
       }
 
-      
       fldmember_password2 = getParam(request,"member_password2");
       if ( isEmpty(pmember_id)) { bPK = false; }
-      
-      sWhere += "member_id=" + toSQL(pmember_id, adNumber);
+     
+      //member_id = toSQL(pmember_id, adNumber); 
+      sWhere += "member_id = ?";
       primaryKeyParams += "<input type=\"hidden\" name=\"PK_member_id\" value=\""+pmember_id+"\"/>";
 
       sSQL = "select * from members where " + sWhere;
@@ -306,7 +310,9 @@
       if ( bPK &&  ! (sAction.equals("insert") && "Reg".equals(sForm))) {
 
         // Open recordset
-        rs = openrs( stat, sSQL);
+	PreparedStatement pstmt = conn.prepareStatement(sSQL);
+   	pstmt.setString(1, pmember_id);
+        rs = pstmt.executeQuery();
         rs.next();
         String[] aFields = getFieldsName( rs );
         getRecordToHash( rs, rsHash, aFields );
diff -Naur bookstore/ShoppingCartRecord.jsp bookstore_secure/ShoppingCartRecord.jsp
--- bookstore/ShoppingCartRecord.jsp	2018-03-04 13:33:53.975755037 -0600
+++ bookstore_secure/ShoppingCartRecord.jsp	2018-03-04 13:32:49.487456315 -0600
@@ -119,7 +119,8 @@
       if ( iAction == iupdateAction || iAction == ideleteAction ) { 
         pPKorder_id = getParam( request, "PK_order_id");
         if ( isEmpty(pPKorder_id)) return sShoppingCartRecordErr;
-        sWhere = "order_id=" + toSQL(pPKorder_id, adNumber);
+	//pPKorder_id = toSQL(pPKorder_id, adNumber);
+        sWhere = "order_id = ?";
       }
 
 
@@ -152,21 +153,24 @@
 
 
       sSQL = "";
+      boolean updateValid = false, deleteValid = false;
       // Create SQL statement
 
       switch (iAction) {
   
       case iupdateAction:
-        
+          //fldmember_id = toSQL(fldmember_id, adNumber);
+          //fldquantity = toSQL(fldmember_id, adNumber);
           sSQL = "update orders set " +
-                "member_id=" + toSQL(fldmember_id, adNumber) +
-                ",quantity=" + toSQL(fldquantity, adNumber);
+                "member_id = ?" +
+                ",quantity = ?";
           sSQL = sSQL + " where " + sWhere;
+	  updateValid = true;
         break;
       
       case ideleteAction:
            sSQL = "delete from orders where " + sWhere;
-          
+           deleteValid = true;
         break;
   
       }
@@ -174,7 +178,15 @@
       if ( sShoppingCartRecordErr.length() > 0 ) return sShoppingCartRecordErr;
       try {
         // Execute SQL statement
-        stat.executeUpdate(sSQL);
+        PreparedStatement pstmt = conn.prepareStatement(sSQL);
+        if (updateValid) {
+	   pstmt.setString(1, fldmember_id);
+	   pstmt.setString(2, fldquantity);
+	   pstmt.setString(3, pPKorder_id);
+	} else if (deleteValid) {
+	   pstmt.setString(1, pPKorder_id);
+	}
+        pstmt.executeUpdate();
       }
       catch(java.sql.SQLException e) {
         sShoppingCartRecordErr = e.toString(); return (sShoppingCartRecordErr);
@@ -235,7 +247,7 @@
       
       if ( isEmpty(porder_id)) { bPK = false; }
       
-      sWhere += "order_id=" + toSQL(porder_id, adNumber);
+      sWhere += "order_id = ?";
       primaryKeyParams += "<input type=\"hidden\" name=\"PK_order_id\" value=\""+porder_id+"\"/>";
 
       sSQL = "select * from orders where " + sWhere;
@@ -254,7 +266,9 @@
       if ( bPK &&  ! (sAction.equals("insert") && "ShoppingCartRecord".equals(sForm))) {
 
         // Open recordset
-        rs = openrs( stat, sSQL);
+        PreparedStatement pstmt = conn.prepareStatement(sSQL);
+        pstmt.setString(1, porder_id);
+        rs = pstmt.executeQuery();
         rs.next();
         String[] aFields = getFieldsName( rs );
         getRecordToHash( rs, rsHash, aFields );
@@ -320,4 +334,4 @@
 
     }
     catch (Exception e) { out.println(e.toString()); }
-  } %>
\ No newline at end of file
+  } %>
